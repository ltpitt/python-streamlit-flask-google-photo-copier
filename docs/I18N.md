# Multilingual UI Implementation (i18n)

## Overview

The Google Photos Sync application now supports multiple languages through a comprehensive internationalization (i18n) system. The implementation follows industry best practices and is designed to be easily extensible for adding new languages in the future.

## Supported Languages

- **English (en)** - Default language
- **Italian (it)** - Full translation

## Architecture

The i18n system is built on the following principles:

1. **JSON-based translations**: Easy to edit, maintain, and version control
2. **Framework-agnostic**: Core translation service can be reused anywhere
3. **Dot notation**: Nested keys like `home.title` or `nav.settings`
4. **Fallback mechanism**: Missing translations fall back to English
5. **Session persistence**: Language choice is remembered during the session
6. **Minimal changes**: Existing code updated with minimal modifications

## File Structure

```
src/google_photos_sync/
â”œâ”€â”€ i18n/
â”‚   â”œâ”€â”€ __init__.py                 # Public API exports
â”‚   â”œâ”€â”€ translator.py               # Core translation service
â”‚   â””â”€â”€ locales/
â”‚       â”œâ”€â”€ en.json                 # English translations
â”‚       â””â”€â”€ it.json                 # Italian translations
â””â”€â”€ ui/
    â””â”€â”€ components/
        â””â”€â”€ language_selector.py    # Language selector widget
```

## Usage

### In Streamlit Components

```python
from google_photos_sync.ui.components.language_selector import (
    get_current_translator,
    render_language_selector,
)

# Get translator for current session language
t = get_current_translator()

# Use translations
st.title(t("home.main_title"))
st.write(t("home.subtitle"))

# With formatting
st.info(t("auth.authenticated_as", email="user@example.com"))

# Render language selector in sidebar
with st.sidebar:
    render_language_selector()
```

### Direct Usage

```python
from google_photos_sync.i18n import get_translator, get_available_languages

# Get specific language
t_it = get_translator("it")
print(t_it("home.title"))  # Output: "Benvenuto in Google Photos Sync"

# List available languages
languages = get_available_languages()  # Returns: ["en", "it"]
```

## Translation Keys Structure

Translation keys use dot notation to organize content hierarchically:

```json
{
  "app": {
    "title": "Google Photos Sync",
    "icon": "ðŸ“¸"
  },
  "nav": {
    "home": "Home",
    "compare": "Compare",
    "sync": "Sync",
    "settings": "Settings"
  },
  "home": {
    "main_title": "ðŸ“¸ Welcome to Google Photos Sync",
    "subtitle": "Safely sync your Google Photos between accounts"
  }
}
```

### Key Categories

- **`app`**: Application-level strings (title, version, icon)
- **`nav`**: Navigation menu items
- **`auth`**: Authentication-related messages
- **`home`**: Home page content
- **`compare`**: Compare page content
- **`sync`**: Sync page content
- **`settings`**: Settings page content
- **`footer`**: Footer links and info
- **`language`**: Language selector labels
- **`status`**: Status indicators

## Adding a New Language

Follow these steps to add support for a new language:

### 1. Create Translation File

Create a new JSON file in `src/google_photos_sync/i18n/locales/`:

```bash
# Example for Spanish (es)
cp src/google_photos_sync/i18n/locales/en.json \
   src/google_photos_sync/i18n/locales/es.json
```

### 2. Translate All Strings

Edit the new file and translate all strings to the target language:

```json
{
  "app": {
    "title": "Google Photos Sync",
    "icon": "ðŸ“¸"
  },
  "nav": {
    "home": "Inicio",
    "compare": "Comparar",
    "sync": "Sincronizar",
    "settings": "ConfiguraciÃ³n"
  }
  // ... continue translating all keys
}
```

**Important**: Keep the same key structure as `en.json`. Only change the values, not the keys.

### 3. Update Language Selector

Edit `src/google_photos_sync/ui/components/language_selector.py`:

```python
# Add your language to language_names dict
language_names = {
    "en": "ðŸ‡¬ðŸ‡§ English",
    "it": "ðŸ‡®ðŸ‡¹ Italiano",
    "es": "ðŸ‡ªðŸ‡¸ EspaÃ±ol",  # Add your language here
}
```

### 4. Test the Translation

```python
from google_photos_sync.i18n import get_translator

t = get_translator("es")
print(t("home.main_title"))
```

### 5. Verify Structure

Run the tests to ensure the translation file structure is correct:

```bash
pytest tests/unit/test_i18n.py -v
```

## Features

### âœ… String Formatting

Translations support Python string formatting:

```python
# Translation: "Authenticated as: {email}"
t("auth.authenticated_as", email="user@example.com")
# Output: "Authenticated as: user@example.com"
```

### âœ… Fallback to English

If a key is missing in the target language, it automatically falls back to English:

```python
t_it = get_translator("it")
# If "new.key" doesn't exist in it.json, returns English version
t_it("new.key")
```

### âœ… Session Persistence

Language choice is stored in Streamlit's session state:

```python
# User's language choice persists across:
# - Page navigation
# - Component reruns
# - Session lifetime
```

### âœ… Extensible Design

Adding new languages requires:
1. One JSON file
2. One line in language_selector.py
3. No changes to existing code

## Best Practices

### DO âœ…

- **Use descriptive keys**: `home.welcome_message` not `hm.wm`
- **Group related keys**: All home page keys under `home.*`
- **Keep translations consistent**: Use same terms throughout
- **Test both languages**: Verify UI in English and Italian
- **Maintain structure**: Keep same JSON structure across all language files

### DON'T âŒ

- **Don't hardcode strings**: Always use translation keys
- **Don't change key names**: Only translate values
- **Don't break JSON**: Validate JSON after editing
- **Don't mix languages**: One language per file
- **Don't skip translations**: Complete all keys in new language files

## Testing

The i18n system has comprehensive test coverage:

```bash
# Run all i18n tests
pytest tests/unit/test_i18n.py -v

# Test specific functionality
pytest tests/unit/test_i18n.py::TestTranslator -v
pytest tests/unit/test_i18n.py::TestGetAvailableLanguages -v
```

### Test Coverage

- âœ… Translator initialization (English, Italian, invalid)
- âœ… Simple translation retrieval
- âœ… Nested key access (dot notation)
- âœ… String formatting with arguments
- âœ… Fallback to English for missing keys
- âœ… Available languages detection
- âœ… Translation file structure validation
- âœ… JSON validity checks

## Demo

Run the demo script to see all translations:

```bash
python demo_i18n.py
```

This displays:
- Available languages
- Side-by-side English and Italian translations
- Key features of the implementation
- Instructions for adding new languages

## Implementation Details

### Translator Class

The `Translator` class provides the core functionality:

```python
class Translator:
    """Translation service for multilingual support."""

    def __init__(self, language: str = "en") -> None:
        """Initialize with language code."""
        self.language = language
        self.translations = self._load_translations(language)
        self.fallback_translations = self._load_translations("en")

    def __call__(self, key: str, **kwargs: Any) -> str:
        """Get translated string."""
        # Try current language first
        # Fall back to English if not found
        # Apply formatting if kwargs provided
```

### Language Selector Component

Simple Streamlit widget for language selection:

```python
def render_language_selector() -> None:
    """Render language selector in Streamlit."""
    # Initialize language in session state
    # Display selectbox with language options
    # Trigger rerun when language changes
```

## Files Modified

The following files were updated to support i18n:

### New Files

- `src/google_photos_sync/i18n/__init__.py`
- `src/google_photos_sync/i18n/translator.py`
- `src/google_photos_sync/i18n/locales/en.json`
- `src/google_photos_sync/i18n/locales/it.json`
- `src/google_photos_sync/ui/components/language_selector.py`
- `tests/unit/test_i18n.py`
- `demo_i18n.py`

### Modified Files

- `src/google_photos_sync/ui/app.py` - Added language selector, translated all strings
- `src/google_photos_sync/ui/components/auth_component.py` - Translated auth messages

### Translation Coverage

| Component | Status |
|-----------|--------|
| Main App (app.py) | âœ… Fully translated |
| Auth Component | âœ… Fully translated |
| Language Selector | âœ… Fully translated |
| Home Page | âœ… Fully translated |
| Settings Page | âœ… Fully translated |
| Navigation | âœ… Fully translated |
| Footer | âœ… Fully translated |

## Future Enhancements

Potential improvements for the i18n system:

1. **Browser language detection**: Auto-detect user's preferred language
2. **Persistence**: Save language choice to local storage or database
3. **RTL support**: Right-to-left languages (Arabic, Hebrew)
4. **Pluralization**: Handle plural forms correctly
5. **Date/time formatting**: Locale-specific date/time formats
6. **Number formatting**: Locale-specific number/currency formats
7. **Translation validation**: Automated checks for missing/extra keys
8. **Translation management**: Web UI for managing translations

## Troubleshooting

### Language not appearing in selector

1. Verify JSON file exists in `src/google_photos_sync/i18n/locales/`
2. Check file name matches pattern: `XX.json` (e.g., `es.json`)
3. Validate JSON syntax: `python -m json.tool < locales/XX.json`

### Translation not working

1. Check key exists in translation file
2. Verify dot notation is correct: `home.title` not `home/title`
3. Ensure translator is using correct language: `t.language == "it"`

### Formatting errors

1. Verify format arguments match: `{email}` in translation, `email=...` in code
2. Check for typos in argument names
3. Use `get()` method for optional arguments

## Support

For issues or questions:
- Check existing translations in `src/google_photos_sync/i18n/locales/`
- Run demo script: `python demo_i18n.py`
- Run tests: `pytest tests/unit/test_i18n.py -v`
- Review this documentation

## License

The i18n implementation follows the same MIT license as the main project.
